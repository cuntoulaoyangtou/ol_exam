<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>登录</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/static/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/login-util.css">
    <link rel="stylesheet" type="text/css" href="/static/css/login-main.css">
	<link rel="stylesheet" type="text/css" href="/static/css/notiflix-1.3.0.min.css">
    <style>
        body {
            font-weight: 500;
            font-size: 1.05em;
            font-family: "Microsoft YaHei", "Segoe UI", "Lucida Grande", Helvetica, Arial, sans-serif;
        }
    </style>
</head>
<body>
<div class="dowebok">
    <div class="container-login100">
        <div class="wrap-login100">
            <div class="login100-pic js-tilt" data-tilt="">
                <img src="/static/imgs/log/img-01.png" alt="IMG">
            </div>

            <form class="login100-form validate-form" id="login" method="post" action="/api/user/login">
				<span class="login100-form-title">
					用户登录
				</span>

                <div class="wrap-input100 validate-input">
                    <input class="input100" type="text" name="phone" placeholder="手机号" required
                           pattern="^[1]([3-9])[0-9]{9}$" maxlength="11">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
						<i class="fa fa-mobile" aria-hidden="true"></i>
					</span>
                </div>

                <div class="wrap-input100 validate-input">
                    <input class="input100" type="password" name="password" placeholder="密码" required
                           pattern="^.{8,20}$" maxlength="20">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
						<i class="fa fa-lock" aria-hidden="true"></i>
					</span>
                </div>

                <div class="container-login100-form-btn">
                    <button class="login100-form-btn">
                        登陆
                    </button>
                </div>

                <div class="text-center p-t-12">
                    <a class="txt2" href="javascript:" onclick="openPage(forget)">
                        忘记密码？
                    </a>
                </div>

                <div class="text-center p-t-136">
                    <a class="txt2" href="javascript:" onclick="openPage(register)">
                        还没有账号？立即注册
                        <i class="fa fa-long-arrow-right m-l-5" aria-hidden="true"></i>
                    </a>
                </div>
            </form>
            <form class="login100-form validate-form" id="forget" style="display: none">
				<span class="login100-form-title">
					忘记密码
				</span>

                <div class="wrap-input100 validate-input">
                    <input class="input100" type="text" name="phone" placeholder="手机号" required
                           pattern="^[1]([3-9])[0-9]{9}$" maxlength="11">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
						<i class="fa fa-mobile" aria-hidden="true"></i>
					</span>
                </div>

                <div class="container-login100-form-btn">
                    <button class="login100-form-btn" onclick="sub(forget)">
                        提交
                    </button>
                </div>

                <div class="text-center p-t-12">
                    <a class="txt2" href="javascript:" onclick="openPage(login)">
                        去登录
                    </a>
                </div>

                <div class="text-center p-t-136">
                    <a class="txt2" href="javascript:" onclick="openPage(register)">
                        还没有账号？立即注册
                        <i class="fa fa-long-arrow-right m-l-5" aria-hidden="true"></i>
                    </a>
                </div>
            </form>
            <form class="login100-form validate-form" id="register" style="display: none" method="post"
                  action="/api/user/register">
				<span class="login100-form-title">
					用户注册
				</span>

                <div class="wrap-input100 validate-input">
                    <input class="input100" type="text" name="phone" placeholder="手机号" required
                           pattern="^[1]([3-9])[0-9]{9}$" maxlength="11">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
						<i class="fa fa-mobile" aria-hidden="true"></i>
					</span>
                </div>

                <div class="wrap-input100 validate-input">
                    <input class="input100" type="password" id="password" name="password" placeholder="密码" required
                           pattern="^.{8,20}$" maxlength="20">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
						<i class="fa fa-lock" aria-hidden="true"></i>
					</span>
                </div>

                <div class="wrap-input100 validate-input">
                    <input class="input100" type="password" name="tmppassword" placeholder="确认密码" required>
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
						<i class="fa fa-lock" aria-hidden="true"></i>
					</span>
                </div>

                <div class="wrap-input100 validate-input">
                    <input class="input100" type="text" name="real_name" placeholder="真实姓名" required
                           pattern="^[\u4e00-\u9fa5]{2,3}$">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
						<i class="fa fa-address-book" aria-hidden="true"></i>
					</span>
                </div>

                <div class="wrap-input100 validate-input">
                    <input class="input100" type="email" name="email" placeholder="邮箱" required
                           pattern="^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
						<i class="fa fa-envelope" aria-hidden="true"></i>
					</span>
                </div>

                <div class="wrap-input100 validate-input">
                    <input class="input100" type="text" name="code" placeholder="邀请码" required maxlength="4"
                           pattern="^[0-9]{4}$">
                    <span class="focus-input100"></span>
                    <span class="symbol-input100">
						<i class="fa fa-share-alt" aria-hidden="true"></i>
					</span>
                </div>

                <div class="container-login100-form-btn">
                    <button class="login100-form-btn" onclick="sub(register)">
                        注册
                    </button>
                </div>

                <div class="text-center p-t-12">
                    <a class="txt2" href="javascript:" onclick="openPage(login)">
                        去登陆
                    </a>
                </div>

            </form>
        </div>
    </div>
</div>
<script src="/static/js/jquery-1.11.0.min.js"></script>
<script src="/static/js/jquery.md5.min.js"></script>
<script src="/static/js/notiflix-1.3.0.min.js"></script>
<script src="/static/js/cookie.js"></script>
<script>
    var loading = true;

    $(function () {
        Notiflix.Notify.Init();
        Notiflix.Report.Init();
        Notiflix.Confirm.Init();
        Notiflix.Loading.Init({
            clickToClose:false
        });
    })
    //打开
    function openPage(page) {
        //隐藏所有
        $(".login100-form").hide(500);
        //显示当前

        setTimeout(function () {
            $(page).show(500);
        }, 600);
    }
    $("#login").on("submit", function(ev) {
        if(loading) {
            loading = false;
            Notiflix.Loading.Standard('正在登录');

            var phone = $("#login").find("[name='phone']").val();
            var password = $("#login").find("[name='password']").val();
            $.get("/api/user/login", {phone: phone, password: $.md5(password)},
                function (data) {
                    console.log(data);
                    if (data.code == "SUCCESS") {
                        //设置cokie
                        setCookie(token,data.data,2*60);
                        //跳转首页
                        location.href = "/";
                    } else {
                        //提示错误信息
                        Notiflix.Notify.Failure(data.message);
                    }
                    loading = true;
                    Notiflix.Loading.Remove();
                });
        }else{
            Notiflix.Notify.Warning('请勿重复点击');
        }
        //阻止submit表单提交
        ev.preventDefault();
        //或者return false
        //return false;
    });

    function sub(page) {
        if(loading){
            loading = false;
            switch (page.id) {
                case 'login':
                    console.log("登录");
                    var phone = $(page).find("[name='phone']").val();
                    var password = $(page).find("[name='password']").val();
                    console.log(phone);
                    console.log($.md5(password));
                    $.get("/api/user/login", {phone: phone, password: $.md5(password)},
                        function (data) {
                            console.log(data);
                            if(data.code == "SUCCESS"){
                                //设置cokie
                            }else{
                                //提示错误信息
                                Notiflix.Notify.Failure(data.message);
                            }
                            loading = true;
                        });
                    break;
                case 'forget':
                    console.log("忘记密码");
                    break
                case 'register':
                    console.log("注册");
                    break;
            }
        }else{
            Notiflix.Notify.Warning('请勿重复点击');
        }

    }

    $("[name='phone']").blur(function (e) {
        var el = e.target;
        console.log(el.value);
        if (el.value) {
            el.setCustomValidity("");//现将有输入时的提示设置为空
        } else if (el.validity.valueMissing) {
            el.setCustomValidity("手机号不能为空");
        }
        ;
        if (el.validity.patternMismatch) {
            el.setCustomValidity("请输入正确的手机号");
        }
    })
    $("[name='password']").blur(function (e) {
        var el = e.target;
        console.log(el.value);
        if (el.value) {
            el.setCustomValidity("");//现将有输入时的提示设置为空
        } else if (el.validity.valueMissing) {
            el.setCustomValidity("密码不能为空");
        }
        ;
        if (el.validity.patternMismatch) {
            el.setCustomValidity("密码长度要求8-20位");
        }
    })
    $("[name='tmppassword']").blur(function (e) {
        var pwd = $("#password").val();
        var el = e.target;
        if (el.value == pwd) {
            el.setCustomValidity("");//现将有输入时的提示设置为空
        } else {
            el.setCustomValidity("两次密码输入不一致");
        }
    })

    $("[name='real_name']").blur(function (e) {
        if (el.value) {
            el.setCustomValidity("");
        } else if (el.validity.valueMissing) {
            el.setCustomValidity("姓名不允许为空");
        }
        ;

        if (el.validity.patternMismatch) {
            el.setCustomValidity("姓名长度要求2-3位");
        }
    })
    $("[name='email']").blur(function (e) {
        if (el.value) {
            el.setCustomValidity("");
        } else if (el.validity.valueMissing) {
            el.setCustomValidity("邮箱不允许为空");
        }
        ;

        if (el.validity.patternMismatch) {
            el.setCustomValidity("邮箱格式不正确");
        }
    })
    $("[name='code']").blur(function (e) {
        if (el.value) {
            el.setCustomValidity("");
        } else if (el.validity.valueMissing) {
            el.setCustomValidity("邀请码不允许为空");
        }
        ;

        if (el.validity.patternMismatch) {
            el.setCustomValidity("邀请码为4位阿拉伯数字");
        }
    })


</script>
</body>
</html>